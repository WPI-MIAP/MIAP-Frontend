<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>DEVES</title>

	<LINK type="text/css" rel="stylesheet" href="styles/layout-default-latest.css" />

    <link rel="stylesheet"  type="text/css"  href="lib/font-awesome/css/font-awesome.min.css">


	<script type="text/javascript" src="lib/jquery.js"></script>
    <script type="text/javascript" src="lib/jquery.layout.js"></script>
    <script type="text/javascript" src="lib/jquery.ui.all.js"></script>
    <script type="text/javascript" src="lib/jquery-latest.js"></script>
    <script type="text/javascript" src="lib/jquery-ui-latest.js"></script>
	<script type="text/javascript" src="lib/jquery.layout-1.3.0.rc30.80.js"></script>


    <link rel="stylesheet" type="text/css" href="styles/style.css"/>
    <link rel="stylesheet" type="text/css" href="styles/zoom_style.css"/>
    <link rel="stylesheet" type="text/css" href="styles/galaxy_style.css"/>

    <script type="text/javascript" src="lib/d3.min.js"></script>
    <script type="text/javascript" src="lib/d3-ForceEdgeBundling.js"></script>
    <script type="text/javascript" src="lib/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="lib/queue.min.js"></script>
    <script type="text/javascript" src="https://rawgit.com/marcj/css-element-queries/master/src/ResizeSensor.js"></script>
    <script type="text/javascript" src="https://rawgit.com/marcj/css-element-queries/master/src/ElementQueries.js"></script>
    <!-- <script type="text/javascript"src="https://d3js.org/d3.v4.min.js"></script> -->



	<script type="text/javascript">
	/********** Below code is taken and modified little bit for the layout maximize button*/
	/*// a var is required because this page utilizes: myLayout.allowOverflow() method*/
	var myLayout; 

	function toggleMaximize ( paneName, cbPane ) {
		var	pane		= cbPane || paneName
			$Pane		= myLayout.panes[ pane ]
		,	state		= myLayout.state
		,	s			= state[ pane ]
		,	container	= state.container
		,	isMaximized	= null
		,	panePaddingAndBorderHeight = s.outerHeight - s.css.height
		,	panePaddingAndBorderWidth  = s.outerWidth  - s.css.width
		;
		if (pane==="south") {
			// console.log(s.css.height, panePaddingAndBorderHeight)
			if ($Pane.height() == s.css.height) {
				$Pane.css({
					height:	container.innerHeight- panePaddingAndBorderHeight //-135
				,	zIndex:	3
				});
				isMaximized = true;
			}
			else { // RESET pane to what state says it *should be*
				$Pane.css({
					height:	s.css.height
				,	zIndex:	1
				});
				isMaximized = false;
			}
		}
		else if (pane==="east" || pane==="west") {
			if ($Pane.width() == s.css.width) {
				s.top = $Pane.css("top"); // save value | TODO: add top/bottom/left/right to state.pane.css data
				// console.log(s.top)
				$Pane.css({
				/*	need to also set top & height if want to cover north/south panes
				   if only want to cover west-center-east panes, then DO NOT set top or height!
					top:	container.insetTop,*/

					// top:80,
					height:	container.innerHeight - 20- panePaddingAndBorderHeight, //-120
					width:	container.innerWidth  - 20 - panePaddingAndBorderWidth
				,	zIndex:	3
				});
				isMaximized = true;
			}
			else { /*RESET pane to what state says it *should be**/ 
				$Pane.css({
					top:	s.top
				,	height:	s.css.height
				,	width:	s.css.width
				,	zIndex:	1
				});
				isMaximized = false;
			}
		}

		/*if no valid pane was passed, then exit now*/
		if (isMaximized === null) return;

		/*set flags so can check a pane's state to see if it is 'maximized'*/
		s.maximized = isMaximized;
		/*set var for use by onresizeall callback to re-maximize pane after window.resize*/
		container.maximizedPane = isMaximized ? pane : '';

		/*OPTIONALLY show/hide all other panes in Layout*/
		for (var i=0; i<5; i++) {
			var name = $.layout.config.allPanes[ i ]
			,	$P = myLayout.panes[ name ];
			if (!$P || name == pane) continue; // SKIP un/maximized pane
			if (isMaximized && $P.is(":visible")) {
				state[ name ].hiddenByMaximize  = true; // set a state-flag
				$P.css("visibility", "hidden"); // make pane invisible
				if (name !== "center")
					myLayout.resizers[ name ].hide(); // ditto for its resizer-bar
			}
			else if (!isMaximized && state[ name ].hiddenByMaximize ) {
				state[ name ].hiddenByMaximize  = false; // clear flag
				$P.css("visibility", "visible"); // reset visibility
				if (name !== "center")
					myLayout.resizers[ name ].show(); // ditto for its resizer-bar
			}
		}

		// if maximized, add events to catch pane.close or resizeAll, which UN-maximize the pane
		if (isMaximized) {
			$Pane.bind("layoutpaneonclose_start.toggleMaximize", toggleMaximize)
				.bind("layoutpaneonresize_start.toggleMaximize", toggleMaximize);
				// TODO: pane.onresize is not reliably firing when layout resized
				//		try adding a callback to layoutonresize_start as well, pane = state.container.maximizedPane
		}
		else {
			// remove events (above) added when pane was maximized
			$Pane.unbind(".toggleMaximize");
			// if (!cbPane) // skip if this is being called by runCallback() to avoid disrupting sequence
			// 	myLayout.resizeAll();
		}
	};


	

	$(document).ready(function () {
		/*Set of drugs for the galaxy view*/
		var drugs_set = ["cyclophosphamide","avandia","furosemide","fluorouracil","diazepam","omeprazole", "plavix", "lansoprazole","naproxen", 'byetta', 'ondansetron', 'metformin', 'abilify', 'victoza', 'zometa', 'xgeva','lantus', 'atorvastatin','humira', 'dexamethasone', 'simvastatin'];
		/* call to galaxy visualzation function with parameter selected*/
		build_Galaxy(drugs_set, "selected")

		myLayout = $('body').layout({
			// enable showOverflow on west-pane so popups will overlap north pane
			// west__showOverflowOnHover: true
			south:{size:150},
			north__resizable: false
			// ,south:{state:close}
			,onresizeall:  function (Instance, state) { toggleMaximize( state.container.maximizedPane ); }

		//,	west__fxSettings_open: { easing: "easeOutBounce", duration: 750 }
		});

		myLayout.close("south")
	
		// console.log(!myLayout.state.south.isClosed)

		myLayout//.bindButton('#toggleAllPanes', 'toggle', 'north')
			// .bindButton('#toggleAllPanes', 'toggle', 'south')
			.bindButton('#toggleAllPanes', 'toggle', 'west')
			.bindButton('#toggleAllPanes', 'toggle', 'east')

 	});

	</script>


	<style type="text/css">
	/**
	 *	Basic Layout Theme
	 *  This theme uses the default layout class-names for all classes
	 *	Add any 'custom class-names', from options: paneClass, resizerClass, togglerClass
	 */

			.ui-layout-pane { /* all 'panes' */ 
				background: #FFF; 
				border: 1px solid #BBB; 
				padding: 10px; 
				overflow: auto;
			} 

			.ui-layout-resizer { /* all 'resizer-bars' */ 
				background: #0a0a67; /*#016c59 ; /*#1c9099; #0a0a67; /*#B6D3F1;*/ 
			} 

			.ui-layout-toggler-hover { /* all 'resizer-bars' */ 
				background: #016c59!important; /*#016c59 ; /*#1c9099; #0a0a67; /*#B6D3F1;*/ 
			} 

			.ui-layout-toggler { /* all 'toggler-buttons' */ 
				background: #AAA; 
			} 
			/* !important is used to override any parental properies or properties defined in some other css*/
			.ui-layout-north{
				background-color: #0a0a67; /*#016c59 ; /* #1c9099;  /*#0a0a67;*/ 
				z-index:100 !important;
				visibility: visible !important;
				color:white !important;
				height: 80px;
				overflow: hidden !important;
				font-size: 16px !important ;
			}

	</style>


	<style type="text/css">
	/**
	 *	ALL CSS below is only for cosmetic and demo purposes
	 *	Nothing here affects the appearance of the layout
	 */

				body {
					font-family: Arial, sans-serif;
					font-size: 0.85em;
					padding: 10px;
					/*background-color: #0a0a67;*/
				}
				p {
					margin: 1em 0;
				}

				ul {
					/* rules common to BOTH inner and outer UL */
					z-index:	100000;
					margin:		1ex 0;
					padding:	0;
					list-style:	none;
					cursor:		pointer;
					border:		1px solid Black;
					/* rules for outer UL only */
					width:		15ex;
					position:	relative;
				}
				ul li {
					background-color: #EEE;
					padding: 0.15em 1em 0.3em 5px;
				}
				ul ul {
					display:	none;
					position:	absolute;
					width:		100%;
					left:		-1px;
					/* Pop-Up */
					bottom:		0;
					margin:		0;
					margin-bottom: 1.55em;
				}
				.ui-layout-north ul ul {
					/* Drop-Down */
					bottom:		auto;
					margin:		0;
					margin-top:	1.45em;
				}

				ul ul li		{ padding: 3px 1em 3px 5px; }
				ul ul li:hover	{ background-color: #FF9; }
				ul li:hover ul	{ display:	block; background-color: #EEE; }

			    .legText{
			    	fill:#FFF;
			    }

			    button{
			    margin: 0;
			    font-family: inherit;
			    font-size: 100%

			    line-height: normal
			    }

	
	</style>

</head>
<body>


<!-- below ui-layouts sets each of the panel and its buttons -->
<div class="ui-layout-north">
	<div>
				 <div id= "selection_menu" style="margin-right:10px;padding:10px; background-color:transparent;">  
	 			 
	                   <div id="buttons_id" style="width:195px">
	                      <span style="font-weight:bold; color:black !important; font-size:12px;"> Select Drugs</span> 
	                      <button id ="reset_button" type="button">Reset</button>
	                   </div>
	                      <select multiple id="drugs_menu"> </select>
	              </div>	                  

                  <!-- <div style="float:left">  -->
					<div style="float:left; width:150px; margin-right:10px;padding:10px;">
						<p class= "white_color" style= "-webkit-margin-after:0px !important;-webkit-margin-before:0px !important; margin-left:5px;"> Filter DDIs:  </p>	
				 		 <input  type="radio" name="filter" value="known"> <label for="option">Known DIARs</label> <br>
			             <input  type="radio" name="filter" value="unknown"><label for="option">Unknown DIARs</label> <br>
			             <input  type="radio" name="filter" value="both" checked="true"><label for="option">Both</label>   <br>
  					</div>
  					<div style= "float:left; width:200px; margin-right:10px;padding:10px;">
			             <p style= "-webkit-margin-after:0px !important; -webkit-margin-before:0px !important">
			                <label class= "white_color" for="nRadius" 
			                       style="display: inline-block; text-align: left">
			                       Selected Score = <span id="nScore_value">None</span>
			                </label>
			                <input class= "white_color" type="range" min="-0.1" max="0.7" step="0.01" value="0.6" id="nScore">
			                <div>  <span class= "white_color" style="float:left">min</span>  <span style="float:right; margin-right:55px">max </span> </div>
			             </p>
	                	<!-- <button id="openAllPanes">Reset All Views</button> -->
						<!-- &nbsp; -->
						<!-- <button id="closeAllPanes">Close All Views</button> -->
						&nbsp;
						<!-- <button id="toggleAllPanes">Toggle All Views</button> -->
						<!-- <button onclick="myLayout.toggle('south')">Toggle Reports</button> -->
						<!-- d3.select("#") -->
	                </div>	

	                <div style="float:left; width:200px; margin-right:10px;padding:10px;">
         				 <p style= "-webkit-margin-after:0px !important;-webkit-margin-before:0px !important;"> Select Score Criteria:  </p>	
				 		 <input  type="radio" name="score_filter" value="known"> Support <br>
			             <input  type="radio" name="score_filter" value="unknown"> Confidence <br>
			             <input  type="radio" name="score_filter" value="both" checked="true" > Reporting Ratio <br>
  					</div>
  					<div id="div_legends" style="float:left; border:0px solid #fff; margin-right:10px;padding:10px;">
	                    <!-- <h2 style="margin-top:10px !important"> Legends </h2> -->
	                    <div id="legend" class = "div_outline">  </div>
	                </div> 

	                <div style="float:left; margin-right:10px;padding:10px;">
	                	<svg id="legend_svg" height="20" width="195"></svg>
	                    <div>  <span style="float:left">Low Score </span>  <span style="float:right">High </span> </div>
	                    <svg id="legend_svg_severity" height="20" width="195"></svg>
	                    <div>  <span style="float:left">No DME Count</span>  <span style="float:right">High </span> </div>

	                </div>	
	                <div style="float:left; margin-right:10px;padding:10px; padding-top:30px;">
	                	Search: <input id="search_txbox" type="text" name="Search" value="Search"  onfocus="if (this.value == 'Search') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search';}" ><br> 
	                </div>	
                   <!-- <button onclick="myLayout.toggle('north')"  style="top:0 0; float:right">Close</button> -->

	</div>			
</div>


<!-- allowOverflow auto-attached by option: west__showOverflowOnHover = true -->
<div id = "div_graph" class="ui-layout-west">

	<button id="max_overivew" onclick="toggleMaximize('west')" style="position:fixed;"> &#x271A;</button>
	<!-- <div id = "div_graph"> </div>  -->

</div>

<div class="ui-layout-south">

	<div id = "div_table">
        <!-- <button id="closeButtonTable">close</button> -->
        <button onclick="myLayout.toggle('south')"  style="position:fixed;">&#x2716;</button>
        <button id="view_reports" onclick="toggleMaximize('south')" style="position:fixed;" >&#x271A;</button>
        <h2 id= "report_heading" class="header_font" > Reports relevant to Drug: Xgeva </h2>


     </div>
     <!--  ***************         if want to have the narrative view uncomment!!! -->
     <!-- <div id ="div_narrative"> <p> FDA contacted the patient for follow-up after she contacted Drug Information to disclose information regarding an adverse event related to domperidone. Domperidone 20 mg 3-4 times per day was prescribed in August 2014 for lactation. The patient noted that her infant was 3 months old when she started using domperidone. The recommendation for use came from a lactation consultant at Mercy General Hospital/Mercy Medical Group, and was then prescribed by the patient's OB/GYN. The patient was receiving monthly prescriptions and was getting them filled at Innovative Compounding Pharmacy. Patient contacted the OB/GYN Office in late December/early January requesting another prescription and was told by the Nurse Practitioner that they planned on weaning her off of the domperidone because the physicians needed to research the long-term side effects of domperidone before further prescribing it. About 3 weeks-1 month later (mid-January 2015), patient developed palpations ("butterflies in my chest") and felt "very tired." She didn't think much of symptoms and attributed them to being tired and having a new baby, so she continued domperidone and tried to get more sleep. Symptoms of malaise, palpitation, "chest pain", syncope-like feelings continued, so patient decided to research domperidone online. After finding out that QT prolongation and sudden death are possibly associated with domperidone (and that the symptoms she was having could be the result of QT prolongation), and that it is not approved in the US, she stopped taking the medication and contacted her OB/GYN office. The office told her that she was incorrect and that domperidone is allowed to be prescribed in the US and that lactation was just an off-label use. Symptoms resolved after domperidone was stopped. Patient also requested an EKG (after stopping domperidone) which was normal. She also wanted to make the FDA aware that domperidone use for lactation is being heavily advertised as a safe method to provide breast milk within the Mercy General Hospital/Mercy Medical Group. She also stated that in women that adopt or have a surrogate carrier, domperidone is being started 6 months before those women even have the infant with them and that they are then continuing the domperidone. Pharmacy, provider, and practice information was provided.</p> </div> -->

	
</div>

<div class="ui-layout-east">
	<!-- <p><button onclick="myLayout.close('east')">Close</button></p> -->
	<button id="view_profile" onclick="toggleMaximize('east')"  style="position:fixed;">&#x271A;</button>
<!-- 
	<div id="div_header">
                    <button id="closeButton">close</button> -->
                    <h2 id= "zoom_heading" class="header_font"> Interaction Profile for Drug:Xgeva  </h2>
     <!-- </div> -->
     <!-- <div id ="div_profile" style="width:300px; height:300px"> </div>   -->
      <div id ="div_profile" style="width:auto; height:100%;"> </div>  
</div>

<div class="ui-layout-center">
		<div  id="galaxy">
					<!-- <div style="float:left;width: 20px;">	 -->
							<button id="toggleAllPanes" style="position:fixed; float:left">&#x271A;</button>
				    <!-- </div> -->
			   <!--  <button id="openAllPanes">Reset All Views</button>
						&nbsp;
						<button id="closeAllPanes">Close All Views</button>
						&nbsp;
						<button id="toggleAllPanes">Toggle All Views</button>
						<button onclick="myLayout.toggle('south')">Toggle Reports</button>
 -->			
				 
				  <div id="button-wrap" style="float:left; margin-left:50px">
				 	<span style="float:left; margin: 10px 20px 10px 0px;"> Sort By: </span>
                      <div id="name" class="button ">NAME</div>
                      <div id="count" class="button">COUNT</div>
                      <div id="severity" class="button active">SEVERITY</div>
                  </div>

                  <!-- <div id= "main_heading_div" class = "div_outline">  Recently Pinned  -->
                  		   <h2  id= "pinned_heading" class="header_font" style="display:none;"> </h2>                          
                           <div id= "pinned_graphs"  style="position:relative; width:100%; display:inline-block; overflow:auto; border-bottom: 0px solid #0f5753; text-align:center;"> 
       
                           </div>
                  <!-- </div> -->

                  <div id="vis" style=""></div>
       </div>              
</div>

</body>
</html>

<script type="text/javascript" src="scripts/dndTree.js"></script>  
<script src="scripts/zoom.js"></script>
<script src="scripts/small_multiples.js"></script>


<script>
   
  var main_drug_radius = 5;
  var known_r = 3;
  var unknown_r = 6;
  var main_drug_color=  "#2196f3"  ;//"green"
  var default_link_color = '#FAEBD7'; //'#fe9929';

  var legend = ['', 'Main Drug', 'Known DIAR', 'Unknown DIAR']

  it = d3.select("#legend").append("svg").attr("class", "legendSvg").attr("width", 160).attr("height", 80),
  it.append("g").attr("transform", "translate(20,0)"),
  Et = it.selectAll("g").data(legend).enter().append("g")

  Et.append("circle").attr("cx", 15).attr("cy", function(t, e) {
    // console.log(t,e)
      return  e * 18 + e

  }).attr("r", function(t) {
    if(t== "Main Drug")
      return main_drug_radius;
    else if (t=='Known DIAR')
      return known_r;
    else if(t=='Unknown DIAR')
      return unknown_r;
    else
      return 4; 

  }).attr("fill", function(t) {
      if(t== "Main Drug")
          return main_drug_color;
      else if (t=='Known DIAR')
        return "white";
      else if(t=='Unknown DIAR')
        return "white";

  })
  .attr("stroke", function(t) {
      if (t=='Known DIAR')
        return "grey";
      else if(t=='Unknown DIAR')
        return "grey";
  }),

  Et.append("text").attr("class", "legText").attr("x", 25).attr("y", function(t, e) {
      return 20 * e 
  }).text(function(t) {
      if(t== "Main Drug")
      return "Main Drug";
    else if (t=='Known DIAR')
      return 'Known DIAR';
    else if(t=='Unknown DIAR')
      return 'Unknown DIAR';
    else if (t=='High Score')
        return 'High Score';
      else if(t=='Low Score')
        return 'Low Score';
  });

   var min_score = -0.1;
   var max_score = 1;

   /*color comain for the legends*/
   var color = d3.scale.linear()
                  .domain([min_score, (min_score+max_score)/2, max_score])
                  // .range(["#fcae91","#de2d26", "#a50f15"]);
                  .range(["hsl(0, 100%, 80%)", "hsl(0, 100%, 64%)","hsl(0, 100%, 25%)"]);
                  // .range(["#fee0d2","#fc9272", "#de2d26"]);
                  // .range(["grey", "#fb6a4a", "red"]);
                  // .range(["#cb181d","#fcae91","#fee5d9"])  


  var color_severity = d3.scale.linear()
                          .domain([0,1,5])
                          // .range(["#fed98e", "#a6bddb", "#2b8cbe"]);
                          .range(["#fed98e", '#a3a3c2', '#666699']);
                          
                          // .range(["#c51b8a", "#fde0dd"]);
                        // .range(["#cb181d","#fcae91","#fee5d9"])  
                        // .range(["#74a9cf",'#8856a7', '#810f7c'])

  // var defs_score = d3.select("#legend_svg").append("defs");

  // /*below are the legneds for the status and severity*/
  //  //Append a linearGradient element to the defs and give it a unique id

  //   var linearGradient = defs_score.append("linearGradient")
  //                            .attr("id", "linear-gradient");

    // d3.select("#legend_svg").append("rect")
    //     .attr("width", 180)
    //     .attr("height", 20)
    //     .style("fill", "url(#linear-gradient)");


    // linearGradient.attr("x1", "0%")
    //               .attr("y1", "0%")
    //               .attr("x2", "100%")
    //               .attr("y2", "0%");
                         

    // linearGradient.selectAll("stop") 
    //               .data( color.range() )                  
    //               .enter().append("stop")
    //               .attr("offset", function(d,i) { return i/(color.range().length-1); })
    //               .attr("stop-color", function(d) { return d; });

    //  var defs_sev = d3.select("#legend_svg_severity").append("defs");             

    // var linearGradientSev = defs_sev.append("linearGradient")
    //                          .attr("id", "linear-gradientSev");

    // d3.select("#legend_svg_severity").append("rect")
    //     .attr("width", 180)
    //     .attr("height", 20)
    //     .style("fill", "url(#linear-gradientSev)");


    // linearGradientSev.attr("x1", "0%")
    //               .attr("y1", "0%")
    //               .attr("x2", "100%")
    //               .attr("y2", "0%");
                         

    // linearGradientSev.selectAll("stop") 
    //               .data( color_severity.range() )                  
    //               .enter().append("stop")
    //               .attr("offset", function(d,i) { return i/(color_severity.range().length-1); })
    //               .attr("stop-color", function(d) { return d; });   



var threshold = d3.scale.quantize()
    .domain([-0.1, 0, 1,0.01, 0.1])
    .range(["#fecc5c", "#fd8d3c", "#f03b20", "#800000"]);

var x = d3.scale.linear()
    .domain([0, 1])
    .range([0, 240]);

var xAxis = d3.svg.axis()
			  .orient("bottom")
			  .tickSize(13)
			  .tickValues(threshold.domain())
			  .tickFormat(function(d) { return d === 0.5 ? formatPercent(d) : formatNumber(100 * d); });

var g = d3.select("#legend_svg").append("g")


g.select("g").call(xAxis)
g.select(".domain")
    .remove();


        
g.selectAll("rect")
  .data(threshold.range().map(function(color) {
    var d = threshold.invertExtent(color);
    return d;
  }))
  .enter().insert("rect", ".tick")
    .attr("height", 20)
    .attr("width", 45)
    .attr("x", function(d,i) { console.log(i); return i*45; })
    .attr("fill", function(d) { return threshold(d[0]); });

	/*############### Legend for the DME #################*/          

	var formatPercent = d3.format(".0%"),
    formatNumber = d3.format(".0f");

var sev_threshold = d3.scale.quantize()
    // .domain([0.11, 0.22, 0.33, 0.50])
    .range(["#A9A9A9", '#bcbddc', '#9e9ac8', '#807dba', '#6a51a3','#4a1486']);


var sev_g = d3.select("#legend_svg_severity").append("g")


sev_g.select("g").call(xAxis)
sev_g.select(".domain")
    .remove();


        
sev_g.selectAll("rect")
  .data(sev_threshold.range().map(function(color) {
    var d = sev_threshold.invertExtent(color);
    return d;
  }))
  .enter().insert("rect", ".tick")
    .attr("height", 20)
    .attr("width", 30)
    .attr("x", function(d,i) { console.log(i); return i*30; })
    .attr("fill", function(d) { return sev_threshold(d[0]); });           

  </script>

